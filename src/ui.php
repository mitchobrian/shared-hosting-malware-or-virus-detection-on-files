<?php

include_once __DIR__ . '/../config.php';

$db = new SQLite3(DB_NAME_AND_PATH);
$statement = $db->prepare('SELECT * FROM files WHERE hash_key = :hash_key AND id = :id;');
$statement->bindValue(':hash_key', $hash);
$statement->bindValue(':id', $id);
$result = $statement->execute();
if ($row = $result->fetchArray()) {
    $newhash = md5(@file_get_contents($row['full_path']));
    $db->exec("UPDATE files SET hash_key = '" .  $newhash . "' WHERE id = '$id'");
    print '<span style=color:green;>hash updated</span>';
} else {
    print '<span style=color:red;>invalid id</span>';
}
