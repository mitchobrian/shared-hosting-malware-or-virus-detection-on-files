<?php

include_once __DIR__ . '/../config.php';
include_once __DIR__ . '/functions.php';

print '<html><head><body style="margin:20px;">';

$db = new SQLite3(DB_NAME_AND_PATH);
$statement = $db->prepare('SELECT * FROM files WHERE hash_key = :hash_key AND id = :id;');
$statement->bindValue(':hash_key', $hash);
$statement->bindValue(':id', $id);
$result = $statement->execute();
if ($row = $result->fetchArray()) {
    if ($clear) {
        $newhash = md5(@file_get_contents($row['full_path']));
        $db->exec("UPDATE files SET hash_key = '" .  $newhash . "' WHERE id = '$id'");
        print '<span style=color:green;>hash updated</span>';
    } else {
        print $row['full_path'];
        if (!isset($_GET['updateable']))
            print "<br /><a href='" . URL . "/?id=" . $id . "&hash=$hash&clear=1'>Update hash</a>";
        print "<br /><br /><div style='max-width:700px;overflow:auto;border:1px solid #d3d3d3;border-radius:6px;padding:10px;'>";
        $content2 = indentContent(@file_get_contents($row['full_path']), $tab = "   ");
        print "<pre style='white-space: pre-wrap;'>" . htmlentities($content2) . "</pre>";
    }
} else {
    print '<span style=color:red;>invalid id</span>';
}

print '</body></head></html>';
