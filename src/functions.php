<?php

function getNextFile($path = ".")
{
    global $allFiles, $whiteList;
    $files = scandir($path);
    foreach ($files as $file) {
        if ($file != "." && $file != "..") {
            $completePath = $path . "/" . $file;
            $stop = false;
            foreach ($whiteList as $white) if (strpos($completePath, $white) !== false) $stop = true;
            if ($stop) continue;
            if (is_dir($completePath)) {
                getNextFile($completePath);
            }
            $allFiles[$completePath] = md5(file_get_contents($completePath));
            //if (count($allFiles) % 1000 === 0) mail('malware@palmomedia.de', 'Malware FILES ' . count($allFiles), "All files: \n" . print_r($allFiles, 1));
        }
    }
}
